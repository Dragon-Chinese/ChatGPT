import{c as e}from"./_@vue_runtime-dom@3.3.4@@vue-7223771d.js";/* empty css                                          */import{d as t,r as s,k as i}from"./_@vue_runtime-core@3.3.4@@vue-69185d8f.js";import{R as o,c as a,a as n}from"./_vue-router@4.2.4@vue-router-031641e8.js";import{E as r}from"./_@element-plus_icons-vue@1.1.4@@element-plus-b55c0ed2.js";import{n as c}from"./_el-table-next@1.0.2@el-table-next-45c158e9.js";import{s as d}from"./_vant@3.6.12@vant-2fdc3f03.js";import{d as l,c as h}from"./_pinia@2.1.6@pinia-408d9fd4.js";import{a as m}from"./_axios@1.5.0@axios-c62df7d0.js";import{m as u}from"./_mitt@3.0.1@mitt-a2488f8e.js";/* empty css                                          */import"./_@vue_shared@3.3.4@@vue-5a722e92.js";import"./_@vue_reactivity@3.3.4@@vue-c0367d69.js";import"./_@vant_use@1.6.0@@vant-e14af15e.js";import"./_@vant_popperjs@1.3.0@@vant-2804c717.js";import"./_vue-demi@0.14.6@vue-demi-f35ceec9.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const p=t({props:{},setup:e=>()=>s("div",{class:"main"},[s(o,null,null)])}),f=t({setup:()=>(i((()=>{})),()=>s(p,null,null))}),g={},v=[{path:"/",redirect:"/mp/home"},{path:"/mp/home",name:"home",component:()=>function(e,t,s){if(!t||0===t.length)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if((e=function(e){return"/"+e}(e))in g)return;g[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(s)for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.href===e&&(!t||"stylesheet"===o.rel))return}else if(document.querySelector(`link[href="${e}"]${o}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),t?new Promise(((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e()))}((()=>import("./home-1dc100ed.js")),["static/js/home-1dc100ed.js","static/js/_vue3-markdown-it@1.0.10@vue3-markdown-it-f66366d0.js","static/js/_clipboard@2.0.11@clipboard-eaf614d7.js","static/js/_vue@3.3.4@vue-ba896a43.js","static/js/_@vue_runtime-dom@3.3.4@@vue-7223771d.js","static/js/_@vue_runtime-core@3.3.4@@vue-69185d8f.js","static/js/_@vue_reactivity@3.3.4@@vue-c0367d69.js","static/js/_@vue_shared@3.3.4@@vue-5a722e92.js","static/js/_process@0.11.10@process-fb5a350b.js","static/js/_vue-clipboard3@2.0.0@vue-clipboard3-be4c93a6.js","static/js/_vant@3.6.12@vant-2fdc3f03.js","static/js/_@vant_use@1.6.0@@vant-e14af15e.js","static/js/_@vant_popperjs@1.3.0@@vant-2804c717.js","static/css/_vant@3.6-80052542.css","static/js/_vue-router@4.2.4@vue-router-031641e8.js","static/js/_@element-plus_icons-vue@1.1.4@@element-plus-b55c0ed2.js","static/js/_el-table-next@1.0.2@el-table-next-45c158e9.js","static/js/_pinia@2.1.6@pinia-408d9fd4.js","static/js/_vue-demi@0.14.6@vue-demi-f35ceec9.js","static/js/_axios@1.5.0@axios-c62df7d0.js","static/js/_mitt@3.0.1@mitt-a2488f8e.js","static/css/home-6a512232.css","static/css/_element-plus@2.3-9378beab.css","static/css/_highlight.js@11.8.0@highlight-f02ba415.css"]),meta:{title:"首页",key:"/cms/home"}}],_=a({history:n(),routes:v}),b=m.create({baseURL:"/api/v1",withCredentials:!0,timeout:111115e3});b.interceptors.request.use((e=>(e.headers["Content-Type"]="application/json",e.headers["X-Requested-With"]="XMLHttpRequest",e.headers.Authorization="Bearer "+localStorage.getItem("token"),e)),(e=>Promise.reject(e))),b.interceptors.response.use((e=>(e.data,e.data)),(e=>(403===e.response.status&&(localStorage.removeItem("token"),location.reload()),Promise.reject(e))));const j=l("data",{state:()=>({title:"AI Chat",tabId:null,session:[],message:null,navList:[],loading:!1,updateTime:"",netErr:!1}),actions:{ActiveChat(e){this.tabId=e,this.GetChat()},GetChat(){var e;(e={chat_id:this.tabId},b({url:"https://jetbra.top/api/v1/ai/chat",method:"get",params:e})).then((e=>{e.chat.messages.unshift({role:"assistant",content:"您好，我是AI，有什么可以帮助您的"}),this.message=e.chat}))},GetChats(){var e;(e={until:this.updateTime&&1*this.updateTime-1||Math.floor(+new Date/1e3)+1e3},b({url:"https://jetbra.top/api/v1/ai/chats",method:"get",params:e})).then((e=>{if(e.chats&&(this.navList=[...this.navList,...e.chats]),!this.navList.length)return this.CreateMessage();this.updateTime=this.navList[this.navList.length-1].updated_at,this.tabId||(this.tabId=this.navList[0].id,this.updateTime=this.navList[this.navList.length-1].updated_at,this.GetChat(!0))}))},SenMsg(e){var t;e&&(this.message.messages.push({role:"user",content:e}),this.message.messages.push({role:"assistant",content:""}),this.loading=!0,this.netErr=!1,(t={message:e,chat_id:this.tabId},b({url:"https://jetbra.top/api/v1/ai/chat",method:"post",data:t})).then((e=>{this.message.messages[this.message.messages.length-1].content=e.message.content,this.loading=!1,this.tabId||(this.tabId=e.chat_id,this.GetChats())})).catch((e=>{this.message.messages[this.message.messages.length-1].content="发送失败，请稍后重试",this.loading=!1,this.netErr=!1})))},SenMsgAlgin(){},CreateMessage(){this.tabId=null,this.message={messages:[{role:"assistant",content:"您好，我是AI，有什么可以帮助您的"}]}},DeleteItem(e){var t;(t={chat_id:e},b({url:"https://jetbra.top/api/v1/ai/chat",method:"delete",params:t})).then((e=>{this.navList=[],this.updateTime="",this.tabId=null,this.GetChats()}))}}});_.beforeEach((async(e,t,s)=>{const i=j();if(/micromessenger/.test(navigator.userAgent.toLowerCase())){const e=window.location.href,t=localStorage.getItem("token");if(e.includes("?code")){const t=e.split("?code=")[1].split("&state")[0];(o={code:t},b({url:"https://jetbra.top/api/v1/wx/oauth",method:"post",data:o})).then((e=>{localStorage.setItem("token",e.token),localStorage.setItem("user",JSON.stringify(e.user));var t=window.location.protocol+"//"+window.location.host+"/#/mp/home";window.history.pushState({},0,t),i.GetChats()}))}else{if(t)return i.GetChats(),s();(()=>{const e=`https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx10cede6667d6d736&redirect_uri=${encodeURIComponent("https://jetbra.top/")}&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect`;window.location.href=e})()}}var o;s()}));const w=Object.freeze(Object.defineProperty({__proto__:null,switchNav:function(){let e=!1;var t,s={trident:(t=navigator.userAgent).indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Firefox")>-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")>-1};return(s.mobile||s.ios||s.android||s.iPhone||s.iPad)&&(e=!0),e}},Symbol.toStringTag,{value:"Module"}));function y(){const e=document.documentElement.clientWidth/375;document.documentElement.style.fontSize=37.5*Math.min(e,2)+"px"}y(),window.onresize=function(){y()};const I=e(f);I.config.globalProperties.$mitt=u();for(const[L,x]of Object.entries(r))I.component(L,x);I.config.globalProperties.$func=w,I.use(h()),I.use(d),I.use(c),I.use(_),I.mount("#app");export{j as u};
